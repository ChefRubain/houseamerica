KJE.MortgageBlendCalc=function(){this.LOAN_2_INTERESTONLY=false;this.LOAN_1_INTERESTONLY=false;this.TOTAL_LOAN_AMOUNT=0;this.BLENDED_RATE=0;this.TERM_IN_MONTHS1=0;this.TERM_IN_MONTHS2=0;this.TOTAL_MONTHLY_PAYMENT=0;this.DS_LOAN_PAYMENT=KJE.FloatArray(2);this.sSchedule=new KJE.Repeating()};KJE.MortgageBlendCalc.prototype.clear=function(){this.PURCHASE_PRICE=0;this.CASH_INVESTED=0;this.LOAN_1_AMOUNT=0;this.INTEREST_RATE_1=0;this.INTEREST_RATE_2=0;this.TERM1=0;this.TERM2=0;this.REAL_ESTATE_TAXES=0;this.INSURANCE=0;this.TAX_BRACKET=0;this.BY_YEAR=1};KJE.MortgageBlendCalc.prototype.calculate=function(G){var b=KJE;var t=this.PURCHASE_PRICE;var h=this.CASH_INVESTED;var C=this.LOAN_1_AMOUNT;var r=this.INTEREST_RATE_1;var p=this.INTEREST_RATE_2;var k=this.TERM1;var j=this.TERM2;var x=this.BY_YEAR;var l=0;var A=0;var z=0;this.TERM_IN_MONTHS1=k*12;this.TERM_IN_MONTHS2=j*12;var F=t-h-C;if(F<0){throw ("Purchase price is less than cash invested and loan 1 amount.")}if(this.LOAN_1_INTERESTONLY){l=b.round((r/1200)*C,2)}else{l=b.round(KJE.PMT(r/1200,this.TERM_IN_MONTHS1,C),2)}if(this.LOAN_2_INTERESTONLY){A=b.round((p/1200)*F,2)}else{A=b.round(KJE.PMT(p/1200,this.TERM_IN_MONTHS2,F),2)}var O=(l+A)*12;this.TOTAL_LOAN_AMOUNT=C+F;if(F<=0){this.BLENDED_RATE=(r/100)}else{this.BLENDED_RATE=b.round((F/this.TOTAL_LOAN_AMOUNT)*(p/100)+(C/this.TOTAL_LOAN_AMOUNT)*(r/100),5)}this.INTEREST_PAID2=0;this.INTEREST_PAID1=0;this.TOTAL_OF_PAYMENTS1=0;this.TOTAL_OF_PAYMENTS2=0;var P=C;var s=0;var e=0;var B=0;var a=0;var E=0;var D=l;var u=l;var M=r/1200;var J=F;var o=0;var v=0;var L=0;var m=0;var c=0;var w=A;var I=A;var f=p/1200;var d=Math.round(this.TERM_IN_MONTHS2>this.TERM_IN_MONTHS1&&F>0&&!this.LOAN_2_INTERESTONLY?this.TERM_IN_MONTHS2:this.TERM_IN_MONTHS1);if((this.LOAN_1_INTERESTONLY&&this.LOAN_2_INTERESTONLY)||(this.LOAN_1_INTERESTONLY&&F==0)){d=360}this.TOTAL_MONTHLY_PAYMENT=A+l;this.DS_LOAN_PAYMENT[0]=(l);this.DS_LOAN_PAYMENT[1]=(A);var g=Math.floor(d/12)+(d%12==0?1:2);this.DS_BALANCE=KJE.FloatArray(g);this.DS_LOAN2_BALANCE=KJE.FloatArray(g);this.cats=KJE.FloatArray(g);if(G){var y=this.sSchedule;y.clearRepeat();if(x==1){y.addHeader(y.sReportCol("Year",1),y.sReportCol("Total<br />Payments",2),y.sReportCol("Total<br />Interest paid",3),y.sReportCol("Total<br />Principal paid",4),y.sReportCol("Total Ending<br />Principal Balance",5))}else{y.addRepeat(y.sReportCol("<br />Nbr",6),y.sReportCol("<br />Monthly Payment",7),y.sReportCol("<br />Interest paid",8),y.sReportCol("<br />Principal paid",9),y.sReportCol("Total Ending<br />Principal Balance",5))}y.addRepeat("&nbsp;","&nbsp;","&nbsp;","&nbsp;",b.dollars(P+J,2))}var N=0;this.cats[0]="0";this.DS_BALANCE[0]=(C);this.DS_LOAN2_BALANCE[0]=(F);var H=1;for(var K=1;K<=d;K++){N=K-1;w=I;o=b.round(f*J,2);v=(this.LOAN_2_INTERESTONLY?0:w-o);J-=v;if(J==0){w=0;v=0;o=0}else{if(J<0||(J>0.005&&this.TERM_IN_MONTHS2==K&&!this.LOAN_2_INTERESTONLY)){v+=J;J=0;w=v+o}else{if(d==K&&!this.LOAN_2_INTERESTONLY){J=0}else{if(K==this.TERM_IN_MONTHS2&&this.LOAN_2_INTERESTONLY){w+=J;v=J;J=0}}}}D=u;s=b.round(M*P,2);e=(this.LOAN_1_INTERESTONLY?0:D-s);P-=e;if(P==0){D=0;e=0;s=0}else{if(P<0||(P>0.005&&this.TERM_IN_MONTHS1==K&&!this.LOAN_1_INTERESTONLY)){e+=P;P=0;D=e+s}else{if(this.TERM_IN_MONTHS1==K&&!this.LOAN_1_INTERESTONLY){J=0}else{if(K==this.TERM_IN_MONTHS1&&this.LOAN_1_INTERESTONLY){D+=P;e=P;P=0}}}}if(x!=1&&G){y.addRepeat(b.number(K),b.dollars(w+D,2),b.dollars(o+s,2),b.dollars(e+v,2),b.dollars(P+J,2))}B+=s;a+=e;E+=D;this.INTEREST_PAID1+=s;this.TOTAL_OF_PAYMENTS1+=D;L+=o;m+=v;c+=w;this.TOTAL_OF_PAYMENTS2+=w;this.INTEREST_PAID2+=o;if((K%12)==0||K==d){if(K==12){z=L+B}this.cats[H]=""+H;this.DS_BALANCE[H]=(P);this.DS_LOAN2_BALANCE[H]=(J);H+=1;if(x==1&&G){y.addRepeat(b.number(H-1),b.dollars(c+E,2),b.dollars(B+L,2),b.dollars(a+m,2),b.dollars(P+J,2))}L=0;m=0;c=0;B=0;a=0;E=0}}this.LOAN_2_AMOUNT=F;this.LOAN_1_PI=l;this.LOAN_2_PI=A;this.ANNUAL_DEBT_SERVICE=O;this.TOTAL_INTEREST=z};KJE.MortgageBlendCalc.prototype.formatReport=function(b){var c=KJE;var a=this.iDecimal;var d=b;d=KJE.replace("TOTAL_LOAN_AMOUNT",c.dollars(this.TOTAL_LOAN_AMOUNT,2),d);d=KJE.replace("TOTAL_MONTHLY_PAYMENT",c.dollars(this.TOTAL_MONTHLY_PAYMENT,2),d);d=KJE.replace("BLENDED_RATE",c.percent(this.BLENDED_RATE,3),d);d=KJE.replace("PURCHASE_PRICE",c.dollars(this.PURCHASE_PRICE,2),d);d=KJE.replace("CASH_INVESTED",c.dollars(this.CASH_INVESTED,2),d);d=KJE.replace("LOAN_1_AMOUNT",c.dollars(this.LOAN_1_AMOUNT,2),d);d=KJE.replace("INTEREST_RATE_1",c.percent(this.INTEREST_RATE_1/100,2),d);d=KJE.replace("LOAN_2_AMOUNT",c.dollars(this.LOAN_2_AMOUNT,2),d);d=KJE.replace("INTEREST_RATE_2",c.percent(this.INTEREST_RATE_2/100,2),d);d=KJE.replace("LOAN_1_PI",c.dollars(this.LOAN_1_PI,2)+(this.LOAN_1_INTERESTONLY?" Interest Only":""),d);d=KJE.replace("TERM1",c.number(this.TERM1),d);d=KJE.replace("LOAN_2_PI",c.dollars(this.LOAN_2_PI,2)+(this.LOAN_2_INTERESTONLY?" Interest Only":""),d);d=KJE.replace("TERM2",c.number(this.TERM2),d);d=KJE.replace("REAL_ESTATE_TAXES",c.dollars(this.REAL_ESTATE_TAXES,2),d);d=KJE.replace("INSURANCE",c.dollars(this.INSURANCE,2),d);d=KJE.replace("TAX_BRACKET",c.percent(this.TAX_BRACKET/100,2),d);d=KJE.replace("ANNUAL_DEBT_SERVICE",c.dollars(this.ANNUAL_DEBT_SERVICE,2),d);d=KJE.replace("TOTAL_INTEREST",c.dollars(this.TOTAL_INTEREST,2),d);d=d.replace("**REPEATING GROUP**",this.sSchedule.getRepeat());this.sSchedule.clearRepeat();return d};KJE.CalcName="Blended Rate Mortgage Calculator";KJE.CalcType="MortgageBlend";KJE.CalculatorTitleTemplate="The Blended Rate for these Mortgages is KJE1";KJE.parseInputs=function(a){a=KJE.replace("**TERM1**",KJE.getMortgageTermDrop("TERM1",30),a);a=KJE.replace("**TERM2**",KJE.getMortgageTermDrop("TERM2",30),a);return a};KJE.initialize=function(){KJE.CalcControl=new KJE.MortgageBlendCalc();KJE.GuiControl=new KJE.MortgageBlend(KJE.CalcControl)};KJE.MortgageBlend=function(p){var g=KJE;var c=KJE.gLegend;var i=KJE.inputs.items;this.MSG_LOAN1=KJE.parameters.get("MSG_LOAN1","Payment one");this.MSG_LOAN2=KJE.parameters.get("MSG_LOAN1","Payment two");this.MSG_LOAN1_BALANCE=KJE.parameters.get("MSG_LOAN1_BALANCE","Loan balance 1");this.MSG_LOAN2_BALANCE=KJE.parameters.get("MSG_LOAN2_BALANCE","Loan balance 2");var k=KJE.parameters.get("MSG_CHECK_HERE","Check here");KJE.MortgageAmtSlider("PURCHASE_PRICE","Purchase Price");KJE.MortgageAmtSlider("CASH_INVESTED","Down payment");KJE.Radioboxes("BY_YEAR","Report amortization",true,"Annually","Monthly");KJE.MortgageAmtSlider("LOAN_1_AMOUNT","Loan amount");KJE.Label("LOAN_2_AMOUNT","Loan amount");KJE.InputItem.AltHelpName="INTEREST_RATE";KJE.MortgageRateSlider("INTEREST_RATE_1","Interest Rate");KJE.MortgageRateSlider("INTEREST_RATE_2","Interest Rate");KJE.InputItem.AltHelpName="TERM";KJE.MortgageTermDropBoxSlider("TERM2","Term in years");KJE.MortgageTermDropBoxSlider("TERM1","Term in years");KJE.InputItem.AltHelpName="LOAN_INTERESTONLY";KJE.Checkbox("LOAN_1_INTERESTONLY","For interest only",false,k);KJE.Checkbox("LOAN_2_INTERESTONLY","For interest only",false,k);KJE.InputItem.AltHelpName="LOAN_PI";KJE.Label("LOAN_1_PI","Monthly payment");KJE.Label("LOAN_2_PI","Monthly payment");var j=KJE.gNewGraph(KJE.gPIE,"GRAPH1",true,false,KJE.colorList[1],"Total monthly payment KJE1");j._legend._iOrientation=c.BOTTOM;j._axisX.setVisible(false);var m=KJE.gNewGraph(KJE.gLINE,"GRAPH2",true,true,KJE.colorList[1],"Loan Balances by Year");m._titleXAxis.setText("Year");var b=KJE.parameters.get("MSG_DROPPER_TITLE","Your home purchase:");var e=KJE.parameters.get("MSG_DROPPER_CLOSETITLE","Total to finance KJE1");var f=function(){return b+"|"+KJE.subText(KJE.getKJEReplaced(e,g.dollars(p.TOTAL_LOAN_AMOUNT,2)),"KJERightBold")};KJE.addDropper(new KJE.Dropper("INPUTS",true,f,f),KJE.colorList[0]);var q=KJE.parameters.get("MSG_DROPPER2_TITLE","Loan one:");var h=KJE.parameters.get("MSG_DROPPER2_CLOSETITLE","Monthly payment: KJE1");var o=function(){return q+"|"+KJE.subText(KJE.getKJEReplaced(h,g.dollars(p.LOAN_1_PI,2)),"KJERightBold")};KJE.addDropper(new KJE.Dropper("INPUTS2",false,o,o),KJE.colorList[0]);var a=KJE.parameters.get("MSG_DROPPER3_TITLE","Loan two:");var d=KJE.parameters.get("MSG_DROPPER3_CLOSETITLE","Monthly payment: KJE1");var n=function(){return a+"|"+KJE.subText(KJE.getKJEReplaced(d,g.dollars(p.LOAN_2_PI,2)),"KJERightBold")};KJE.addDropper(new KJE.Dropper("INPUTS3",false,n,n),KJE.colorList[0])};KJE.MortgageBlend.prototype.setValues=function(b){var a=KJE.inputs.items;b.LOAN_2_INTERESTONLY=a.LOAN_2_INTERESTONLY.getValue();b.LOAN_1_INTERESTONLY=a.LOAN_1_INTERESTONLY.getValue();b.PURCHASE_PRICE=a.PURCHASE_PRICE.getValue();b.CASH_INVESTED=a.CASH_INVESTED.getValue();b.LOAN_1_AMOUNT=a.LOAN_1_AMOUNT.getValue();b.INTEREST_RATE_1=a.INTEREST_RATE_1.getValue();b.INTEREST_RATE_2=a.INTEREST_RATE_2.getValue();b.TERM1=a.TERM1.getValue();b.TERM2=a.TERM2.getValue();b.BY_YEAR=a.BY_YEAR.getValue()};KJE.MortgageBlend.prototype.refresh=function(f){var e=KJE;var d=KJE.gLegend;var b=KJE.inputs.items;var a=KJE.gGraphs[0];var c=KJE.gGraphs[1];KJE.setTitleTemplate(e.percent(f.BLENDED_RATE,3));a.removeAll();a.setTitleTemplate(e.dollars(f.TOTAL_MONTHLY_PAYMENT,2));a.setGraphCategories([this.MSG_LOAN1+" "+f.LOAN_1_PI,this.MSG_LOAN2+" "+f.LOAN_2_PI]);a.add(new KJE.gGraphDataSeries(f.DS_LOAN_PAYMENT,this.MSG_LOAN1,a.getColor(1),e.dollars(f.LOAN_1_PI,2)));a.paint();c.removeAll();c.setGraphCategories(f.cats);c.add(new KJE.gGraphDataSeries(f.DS_BALANCE,this.MSG_LOAN1_BALANCE,c.getColor(1)));if(f.LOAN_2_AMOUNT>0){c.add(new KJE.gGraphDataSeries(f.DS_LOAN2_BALANCE,this.MSG_LOAN2_BALANCE,c.getColor(2)))}c.paint();b.LOAN_2_AMOUNT.setText(e.dollars(f.LOAN_2_AMOUNT,2));b.LOAN_1_PI.setText(e.dollars(f.LOAN_1_PI,2));b.LOAN_2_PI.setText(e.dollars(f.LOAN_2_PI,2))};KJE.InputScreenText=" <div id=KJE-D-INPUTS><div id=KJE-P-INPUTS>Input information:</div></div> <div id=KJE-E-INPUTS > <div id='KJE-C-PURCHASE_PRICE'><input id='KJE-PURCHASE_PRICE' /></div> <div id='KJE-C-CASH_INVESTED'><input id='KJE-CASH_INVESTED' /></div> <div id=\"KJE-C-BY_YEAR\"><fieldset id='KJE-FS-BY_YEAR'><input id=\"KJE-BY_YEAR1\" type=radio name=BY_YEAR /><input id=\"KJE-BY_YEAR2\" type=radio name=BY_YEAR /></fieldset></div> <div style=\"height:10px\"></div> </div> <div id=KJE-D-INPUTS2><div id=KJE-P-INPUTS2>Input information:</div></div> <div id=KJE-E-INPUTS2 > <div id='KJE-C-LOAN_1_AMOUNT'><input id='KJE-LOAN_1_AMOUNT' /></div> <div id='KJE-C-INTEREST_RATE_1'><input id='KJE-INTEREST_RATE_1' /></div> <div id='KJE-C-TERM1'>**TERM1**</div> <div id='KJE-C-LOAN_1_PI'><div id='KJE-LOAN_1_PI' ></div></div> <div id='KJE-C-LOAN_1_INTERESTONLY'><input id='KJE-LOAN_1_INTERESTONLY' type=checkbox /></div> <div style=\"height:10px\"></div> </div> <div id=KJE-D-INPUTS3><div id=KJE-P-INPUTS3>Input information:</div></div> <div id=KJE-E-INPUTS3> <div id='KJE-C-LOAN_2_AMOUNT'><div id='KJE-LOAN_2_AMOUNT' ></div></div> <div id='KJE-C-INTEREST_RATE_2'><input id='KJE-INTEREST_RATE_2' /></div> <div id='KJE-C-TERM2'>**TERM2**</div> <div id='KJE-C-LOAN_2_PI'><div id='KJE-LOAN_2_PI' ></div></div> <div id='KJE-C-LOAN_2_INTERESTONLY'><input id='KJE-LOAN_2_INTERESTONLY' type=checkbox /></div> <div style=\"height:10px\"></div> </div> **GRAPH1** **GRAPH2** ";KJE.DefinitionText=" <div id='KJE-D-PURCHASE_PRICE' ><dt>Purchase price</dt><dd>The price of the home you wish to purchase. This is the total price you'll pay for this property, including any closing costs.</dd></div> <div id='KJE-D-CASH_INVESTED' ><dt>Down payment</dt><dd>The total amount you have available to use towards the purchase of this property.</dd></div> <div id='KJE-D-LOAN_1_AMOUNT' ><dt>Loan one amount</dt><dd>The total amount that will be financed by your first mortgage. Normally, your first mortgage will carry a lower interest rate than a second mortgage.</dd></div> <div id='KJE-D-LOAN_2_AMOUNT' ><dt>Loan two amount</dt><dd>The total amount that will be financed by your second mortgage.</dd></div> <div id='KJE-D-INTEREST_RATE' ><dt>Interest rate</dt><dd>The current annual interest rate you can receive on your mortgage.</dd></div> <div id='KJE-D-TERM' ><dt>Term</dt><dd>The number of years over which you will repay the loan. The most common mortgage terms are 15 years and 30 years.</dd></div> <div id='KJE-D-LOAN_INTERESTONLY' ><dt>Interest only checkbox</dt><dd>Check here to indicate that this mortgage will be an interest only mortgage. We assume that your interest only mortgage will have a balloon payment for the entire balance at the end of the selected term.</dd></div> <div id='KJE-D-LOAN_PI' ><dt>Monthly payment</dt><dd>Monthly principal and interest payment for the loan. If this is an interest only mortgage, this amount will be an interest only payment.</dd></div> ";KJE.ReportText=' <!--HEADING "Blended Rate Mortgage Calculator" HEADING--> <h2 class=\'KJEReportHeader KJEFontHeading\'>The blended rate for your first and second mortgage is BLENDED_RATE.</h2> This is based on a first mortgage of LOAN_1_AMOUNT at INTEREST_RATE_1 and a second mortgage of LOAN_2_AMOUNT at INTEREST_RATE_2. Your total payment is TOTAL_MONTHLY_PAYMENT per month. **GRAPH** <div class=KJEReportTableDiv><table class=KJEReportTable><caption class=\'KJEHeaderRow KJEHeading\'>Mortgage Loan Summary</caption> <tfoot class=\'KJEReportTFooter\'> <tr class=KJEFooterRow><th class="KJELabel KJECellBorder" scope=\'row\'>Total amount financed </th><td class="KJECellStrong"> TOTAL_LOAN_AMOUNT </td></tr> <tr class=KJEFooterRow><th class="KJELabel KJECellBorder" scope=\'row\'>Total monthly payment </th><td class="KJECellStrong"> TOTAL_MONTHLY_PAYMENT </td></tr> <tr class=KJEFooterRow><th class="KJELabel KJECellBorder" scope=\'row\'>Blended interest rate </th><td class="KJECellStrong"> BLENDED_RATE</td></tr> </tfoot> <tbody class=\'KJEReportTBody\'> <tr class=KJEOddRow><th class="KJELabel KJECellBorder KJECell60" scope=\'row\'>Purchase Price </th><td class="KJECell KJECell40"> PURCHASE_PRICE </td></tr> <tr class=KJEEvenRow><th class="KJELabel KJECellBorder" scope=\'row\'>Down payment </th><td class="KJECell"> CASH_INVESTED </td></tr> </tbody> </table> </div> <div class=KJEReportTableDiv><table class=KJEReportTable><caption class=\'KJEHeaderRow KJEHeading\'>Loan One Details</caption> <tbody class=\'KJEReportTBody\'> <tr class=KJEOddRow><th class="KJELabel KJECellBorder KJECell60" scope=\'row\'>Loan amount </th><td class="KJECell"> LOAN_1_AMOUNT </td></tr> <tr class=KJEEvenRow><th class="KJELabel KJECellBorder" scope=\'row\'>Interest Rate </th><td class="KJECell"> INTEREST_RATE_1 </td></tr> <tr class=KJEOddRow><th class="KJELabel KJECellBorder" scope=\'row\'>Term </th><td class="KJECell"> TERM1 years</td></tr> <tr class=KJEEvenRow><th class="KJELabel KJECellBorder" scope=\'row\'>Monthly payment </th><td class="KJECell"> LOAN_1_PI </td></tr> </tbody> </table> </div> <div class=KJEReportTableDiv><table class=KJEReportTable><caption class=\'KJEHeaderRow KJEHeading\'>Loan Two Details</caption> <tbody class=\'KJEReportTBody\'> <tr class=KJEOddRow><th class="KJELabel KJECellBorder KJECell60" scope=\'row\'>Loan amount </th><td class="KJECell KJECell40"> LOAN_2_AMOUNT </td></tr> <tr class=KJEEvenRow><th class="KJELabel KJECellBorder" scope=\'row\'>Interest Rate </th><td class="KJECell"> INTEREST_RATE_2 </td></tr> <tr class=KJEOddRow><th class="KJELabel KJECellBorder" scope=\'row\'>Term </th><td class="KJECell"> TERM2 years </td></tr> <tr class=KJEEvenRow><th class="KJELabel KJECellBorder" scope=\'row\'>Monthly payment </th><td class="KJECell"> LOAN_2_PI </td></tr> </tbody> </table> </div> **GRAPH** <h2 class=\'KJEScheduleHeader KJEFontHeading\'>Amortization Schedule</h2> **REPEATING GROUP** ';